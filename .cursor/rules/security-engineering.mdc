---
description: CyberSec and SecOps engineering principles enforced across the entire Tracehound codebase.
alwaysApply: true
---

# Security Engineering Standards

## Zero-Trust Input Validation

- ALL external data is untrusted. Validate at the boundary, not inside core logic.
- Scent payloads MUST be validated and size-checked before any processing.
- Never trust `Content-Length` headers; measure actual byte length.
- Reject malformed input immediately; do not attempt correction or fallback parsing.

## Cryptographic Integrity

- Hash algorithm: SHA-256. Do not introduce alternative hash algorithms without RFC.
- AuditChain hash links MUST be verified on read. Broken chains = tamper alert.
- Constant-time comparison (`compare.ts`) is MANDATORY for all hash/signature comparisons. Using `===` for security-sensitive byte comparison is a critical vulnerability.
- Signature generation MUST be deterministic: identical input = identical signature, always.

## Secret and Credential Management

- **Zero hardcoded secrets.** License keys, API keys, tokens read from environment only.
- `.env` files MUST be in `.gitignore`. Committing secrets = immediate incident.
- Error messages and logs MUST NOT contain secrets, tokens, or raw credentials.

## Dependency Security Policy

- Core package has ONE runtime dependency (`uuid`). Adding new dependencies requires:
  1. Security audit of the package (known CVEs, maintainer reputation)
  2. Justification in PR description
  3. Explicit approval
- Prefer Node.js built-in APIs (`crypto`, `zlib`, `child_process`) over third-party packages.
- Pin dependency versions. No `*` or `latest` in production dependencies.

## Memory-Bound Guarantees

- Every buffer, map, and collection MUST have an explicit upper bound.
- Unbounded allocation (growing arrays, maps without eviction) is REJECTED.
- Quarantine: bounded by `maxCount` + `maxBytes`. HoundPool: bounded by `maxActive`.
- Rate limiter state: bounded by TTL-based expiration.

## Process Isolation

- Child processes are ONLY created through HoundPool via ProcessAdapter.
- Hound processes run with: no `eval`, no network access, no filesystem writes.
- Process termination: graceful SIGTERM first, SIGKILL after timeout. No orphan processes.
- IPC is binary length-prefixed protocol only. No JSON over stdin/stdout in production.

## Fail-Open Semantics

- If Tracehound throws, the host application MUST receive a safe `InterceptResult` (status: `'error'`).
- NEVER use `process.exit()` in library code. NEVER throw unhandled exceptions.
- FailSafe monitors panic thresholds; it alerts, it does NOT terminate the host.

## PII and Data Exposure

- Log messages, error contexts, and audit records MUST NOT contain PII (IPs, emails, names, tokens).
- Evidence payloads are compressed + hashed. Raw payload access only inside quarantine boundary.
- `TracehoundError.context` may contain structural metadata, never raw user data.

## Supply Chain Hardening

- Lock files (`pnpm-lock.yaml`) MUST be committed. Reproducible installs are mandatory.
- `--frozen-lockfile` in CI. No surprise dependency resolution in production builds.
- Runtime flag `--frozen-intrinsics` recommended for production deployments.
